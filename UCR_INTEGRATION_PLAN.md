# UCR Integration Plan - intervals-mcp-serverçµ±åˆè¨ˆç”»

## èƒŒæ™¯ã¨ç›®çš„

### ç¾çŠ¶ã®èª²é¡Œ
- **calcReadiness**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®GASå®Ÿè£…ã‚’æ¯æ—¥æ‰‹å‹•å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- æœèµ·ãã¦ã‹ã‚‰ã‚¦ã‚§ãƒ«ãƒã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã€30åˆ†å¾Œãã‚‰ã„ã«ã¯ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ã—ãŸã„
- ãã®åˆé–“ã«Claudeã«å›å¾©çŠ¶æ³ã‚’ç¢ºèªã—ã€äºˆå®šé€šã‚Šå§‹ã‚ã‚‹ã‹ã©ã†ã‹ã‚’æ±ºã‚ãŸã„
- æ—¥æ¬¡è‡ªå‹•å®Ÿè¡Œã§ã¯èµ·åºŠæ™‚é–“ãŒå¤‰å‹•ã™ã‚‹ãŸã‚å¯¾å¿œã§ããªã„

### è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
intervals-mcp-serverã«UCRè¨ˆç®—æ©Ÿèƒ½ã‚’çµ±åˆã—ã€ClaudeçµŒç”±ã§ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã«UCRè©•ä¾¡ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 1. UCRè¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³ã®ç§»æ¤
**ãƒ•ã‚¡ã‚¤ãƒ«**: `ucr-calculator.ts`, `ucr-types.ts`

**ç§»æ¤å†…å®¹**:
- GASã®`ReadinessCalculator.js`ã‹ã‚‰TypeScriptã¸ã®å®Œå…¨ç§»æ¤
- UCRã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•°ã€ç·šå½¢é–¢æ•°ï¼‰
- ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³è¨ˆç®—ï¼ˆHRV 60æ—¥ã€RHR 30æ—¥ï¼‰
- å‰¯äº¤æ„Ÿç¥çµŒé£½å’Œæ¤œå‡º
- ä¿®æ­£å› å­é©ç”¨ï¼ˆã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ã€ç­‹è‚‰ç—›ã€ã‚±ã‚¬ç­‰ï¼‰
- intervals.icu wellness scaleå¤‰æ›ï¼ˆ1-4 â†’ 1-5ï¼‰

### 2. intervals.icu APIçµ±åˆ
**ç¾åœ¨ã®å®Ÿè£…**: `IntervalsIcuApi.js`ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ´»ç”¨

**APIå‘¼ã³å‡ºã—ãƒ‘ã‚¿ãƒ¼ãƒ³**:
```typescript
// ã‚¦ã‚§ãƒ«ãƒã‚¹ãƒ‡ãƒ¼ã‚¿å–å¾—
GET /api/v1/athlete/{athleteId}/wellness?oldest={date}&newest={date}

// ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ›´æ–°
PUT /api/v1/athlete/{athleteId}/wellness/{date}
Body: {
  "readiness": 82,
  "UCRMomentum": -12.5,
  "UCRVolatility": 3.8,
  "UCRTrendState": 6,
  "UCRTrendInterpretation": "..."
}
```

**èªè¨¼**: Basicèªè¨¼ï¼ˆAPI_KEYï¼‰

### 3. MCPãƒ„ãƒ¼ãƒ«è¨­è¨ˆ

#### 3.1 get_ucr_assessment
**ç›®çš„**: æŒ‡å®šæ—¥ã®UCRè©•ä¾¡ã‚’å–å¾—
```json
{
  "name": "get_ucr_assessment",
  "description": "æŒ‡å®šæ—¥ã®UCRï¼ˆUnified Continuous Readinessï¼‰è©•ä¾¡ã‚’è¨ˆç®—ãƒ»å–å¾—",
  "inputSchema": {
    "type": "object",
    "properties": {
      "date": {
        "type": "string",
        "description": "è©•ä¾¡æ—¥(YYYY-MM-DDã€çœç•¥æ™‚ã¯ä»Šæ—¥)"
      },
      "include_trends": {
        "type": "boolean", 
        "description": "ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã‚’å«ã‚€ã‹"
      }
    }
  }
}
```

#### 3.2 calculate_ucr_trends
**ç›®çš„**: UCRãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼ˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ãƒ»ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰
```json
{
  "name": "calculate_ucr_trends", 
  "description": "UCRãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼ˆ7æ—¥ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ã€14æ—¥ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£ã€27ã‚¹ãƒ†ãƒ¼ãƒˆè§£é‡ˆï¼‰",
  "inputSchema": {
    "type": "object",
    "properties": {
      "target_date": {"type": "string"},
      "update_intervals": {"type": "boolean", "description": "intervals.icuã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ä¿å­˜ã™ã‚‹ã‹"}
    }
  }
}
```

#### 3.3 update_wellness_assessment
**ç›®çš„**: ã‚¦ã‚§ãƒ«ãƒã‚¹ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã¨UCRå†è¨ˆç®—
```json
{
  "name": "update_wellness_assessment",
  "description": "ä¸»è¦³çš„ã‚¦ã‚§ãƒ«ãƒã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¦UCRè©•ä¾¡ã‚’å†è¨ˆç®—", 
  "inputSchema": {
    "type": "object",
    "properties": {
      "date": {"type": "string"},
      "fatigue": {"type": "integer", "minimum": 1, "maximum": 4},
      "stress": {"type": "integer", "minimum": 1, "maximum": 4},
      "motivation": {"type": "integer", "minimum": 1, "maximum": 4},
      "soreness": {"type": "integer", "minimum": 1, "maximum": 4},
      "injury": {"type": "integer", "minimum": 1, "maximum": 4}
    }
  }
}
```

## å®Ÿè£…è©³ç´°

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
1. **Claudeè¦æ±‚** â†’ MCPãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—
2. **intervals.icu API** â†’ ã‚¦ã‚§ãƒ«ãƒã‚¹ãƒ‡ãƒ¼ã‚¿å–å¾—
3. **UCRCalculator** â†’ ã‚¹ã‚³ã‚¢ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—
4. **intervals.icu API** â†’ ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ›´æ–°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
5. **Claudeå¿œç­”** â†’ UCRè©•ä¾¡ã¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ¨å¥¨

### UCRè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç§»æ¤å¯¾è±¡ï¼‰

#### ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³è¨ˆç®—
```typescript
// HRV: 60æ—¥ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã€7æ—¥ç§»å‹•å¹³å‡ï¼ˆlnå¤‰æ›ï¼‰
const hrvBaseline = {
  mean60: calculateMean(lnHrvData60),
  sd60: calculateStdDev(lnHrvData60),
  mean7: calculateMean(lnHrvData7)
};

// RHR: 30æ—¥ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³
const rhrBaseline = {
  mean30: calculateMean(rhrData30),
  sd30: calculateStdDev(rhrData30)
};
```

#### UCRã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆé€£ç¶šçš„ï¼‰
```typescript
// HRV: ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•° (k=0.6, c=-0.8)
const hrvScore = 40 / (1 + Math.exp(-k * (zScore - c)));

// RHR: ç·šå½¢é–¢æ•° (baseline=16, slope=5)  
const rhrScore = baseline + (zScore * slope);

// æœ€çµ‚ã‚¹ã‚³ã‚¢ = HRV(40) + RHR(20) + Sleep(20) + Subjective(20)
```

#### å‰¯äº¤æ„Ÿç¥çµŒé£½å’Œæ¤œå‡º
```typescript
if (lnCurrentHRV < lowerBound && currentRHR < rhrMean) {
  // ä½HRV + ä½RHR = è‰¯å¥½ãªçŠ¶æ…‹ï¼ˆæº€ç‚¹ï¼‰
  return 40;
}
```

### intervals.icuã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰çµ±åˆ
**Pascal caseå‘½å**:
- `UCRMomentum`: ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ å€¤ï¼ˆ-100ï½+100%ï¼‰
- `UCRVolatility`: ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£å€¤ï¼ˆ0ï½20ï¼‰
- `UCRTrendState`: 9ã‚¹ãƒ†ãƒ¼ãƒˆæ•°å€¤ã‚³ãƒ¼ãƒ‰ï¼ˆ1-9ï¼‰
- `UCRTrendInterpretation`: è§£é‡ˆãƒ†ã‚­ã‚¹ãƒˆ
- `UCRVolatilityLevel`: HIGH/MODERATE/LOW
- `UCRVolatilityBandPosition`: -2.0ï½+2.0

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- intervals.icu APIèªè¨¼ã‚¨ãƒ©ãƒ¼
- ãƒ‡ãƒ¼ã‚¿ä¸è¶³ï¼ˆæœ€å°7æ—¥é–“ã®HRV/RHRãƒ‡ãƒ¼ã‚¿ï¼‰
- ä¸æ­£ãªå…¥åŠ›å€¤æ¤œè¨¼
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®ãƒªãƒˆãƒ©ã‚¤

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š
- **å³åº§ã®è©•ä¾¡**: æœèµ·ãã¦30åˆ†ä»¥å†…ã«UCRè©•ä¾¡ã‚’å–å¾—
- **æ„æ€æ±ºå®šæ”¯æ´**: ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å®Ÿæ–½åˆ¤æ–­ã®å®¢è¦³çš„æ ¹æ‹ 
- **æ‰‹å‹•ä½œæ¥­å‰Šæ¸›**: GASå®Ÿè¡Œã®å¿…è¦æ€§ã‚’æ’é™¤

### 2. ãƒ‡ãƒ¼ã‚¿é€£æºå¼·åŒ–
- **Single Source of Truth**: intervals.icuã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€å…ƒæ´»ç”¨
- **Claudeçµ±åˆ**: è‡ªç„¶è¨€èªã§ã®UCRè©•ä¾¡ç›¸è«‡
- **ç¶™ç¶šæ€§**: GASç‰ˆã¨åŒç­‰ã®è¨ˆç®—ç²¾åº¦ã‚’ç¶­æŒ

### 3. æ‹¡å¼µæ€§
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ´»ç”¨**: intervals.icuã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆ
- **ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ**: 27ã‚¹ãƒ†ãƒ¼ãƒˆè§£é‡ˆãƒãƒˆãƒªã‚¯ã‚¹
- **å°†æ¥çš„æ©Ÿèƒ½è¿½åŠ **: ACWRã€Training Monotonyç­‰

## æŠ€è¡“çš„è€ƒæ…®äº‹é …

### 1. æ—¥ä»˜ãƒ»ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å‡¦ç†
- **GAS â†’ TypeScript**: `formatDateForApi`é–¢æ•°ã®ç§»æ¤
- **intervals.icu API**: ISO 8601å½¢å¼ï¼ˆYYYY-MM-DDï¼‰
- **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³çµ±ä¸€**: UTCãƒ™ãƒ¼ã‚¹ã§ã®å‡¦ç†

### 2. æ•°å€¤ç²¾åº¦
- **floating point**: JavaScriptã®æ•°å€¤ç²¾åº¦å•é¡Œå¯¾ç­–
- **ä¸¸ã‚å‡¦ç†**: UCRã‚¹ã‚³ã‚¢ã¯æ•´æ•°ã€ãƒˆãƒ¬ãƒ³ãƒ‰å€¤ã¯å°æ•°ç‚¹1-2æ¡

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **APIå‘¼ã³å‡ºã—æœ€é©åŒ–**: å¿…è¦æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**: åŒæ—¥å†…ã®é‡è¤‡è¨ˆç®—å›é¿
- **ãƒãƒƒãƒå‡¦ç†**: è¤‡æ•°æ—¥è©•ä¾¡æ™‚ã®åŠ¹ç‡åŒ–

### 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **API KEYç®¡ç†**: ç’°å¢ƒå¤‰æ•°ã§ã®é©åˆ‡ãªç®¡ç†
- **å…¥åŠ›æ¤œè¨¼**: å…¨å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
- **ã‚¨ãƒ©ãƒ¼æƒ…å ±**: æ©Ÿå¯†æƒ…å ±ã®æ¼æ´©é˜²æ­¢

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

### Phase 1: åŸºç›¤å®Ÿè£… âœ…
- [x] UCRå‹å®šç¾©ï¼ˆucr-types.tsï¼‰
- [x] UCRCalculatorã‚¯ãƒ©ã‚¹ï¼ˆucr-calculator.tsï¼‰
- [x] åŸºæœ¬çš„ãªè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ç§»æ¤

### Phase 2: APIçµ±åˆ ğŸ”„
- [ ] intervals.icu API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…
- [ ] èªè¨¼ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] ã‚¦ã‚§ãƒ«ãƒã‚¹ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»å¤‰æ›

### Phase 3: MCPãƒ„ãƒ¼ãƒ«å®Ÿè£…
- [ ] get_ucr_assessmentå®Ÿè£…
- [ ] calculate_ucr_trendså®Ÿè£…ï¼ˆUCRTrendCalculator.jsç§»æ¤å«ã‚€ï¼‰
- [ ] update_wellness_assessmentå®Ÿè£…

### Phase 4: ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼
- [ ] GASç‰ˆã¨ã®è¨ˆç®—çµæœæ¯”è¼ƒæ¤œè¨¼
- [ ] intervals.icuã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ›´æ–°ãƒ†ã‚¹ãƒˆ
- [ ] ClaudeçµŒç”±ã§ã®æ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºç«‹

### Phase 5: é‹ç”¨é–‹å§‹
- [ ] æœ¬æ ¼é‹ç”¨é–‹å§‹
- [ ] GASç‰ˆã¨ã®ä¸¦è¡Œé‹ç”¨æœŸé–“
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ç²¾åº¦ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

## æˆåŠŸæŒ‡æ¨™

1. **æ©Ÿèƒ½æ€§**: GASç‰ˆã¨Â±2ç‚¹ä»¥å†…ã®è¨ˆç®—ç²¾åº¦
2. **å¿œç­”æ€§**: Claudeè¦æ±‚ã‹ã‚‰5ç§’ä»¥å†…ã®å¿œç­”
3. **ä¿¡é ¼æ€§**: 99%ä»¥ä¸Šã®æˆåŠŸç‡ï¼ˆAPIå‘¼ã³å‡ºã—ï¼‰
4. **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£**: æœã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ™‚é–“50%çŸ­ç¸®

## ãƒªã‚¹ã‚¯è¦å› ã¨å¯¾ç­–

### 1. intervals.icu APIåˆ¶é™
**ãƒªã‚¹ã‚¯**: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€APIä»•æ§˜å¤‰æ›´
**å¯¾ç­–**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½

### 2. è¨ˆç®—ç²¾åº¦ã®å·®ç•°
**ãƒªã‚¹ã‚¯**: GASç‰ˆã¨ã®çµæœä¸ä¸€è‡´
**å¯¾ç­–**: è©³ç´°ãªæ¤œè¨¼ãƒ†ã‚¹ãƒˆã€æ®µéšçš„ç§»è¡Œ

### 3. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§
**ãƒªã‚¹ã‚¯**: intervals.icuãƒ‡ãƒ¼ã‚¿ã®æ¬ æãƒ»ç•°å¸¸å€¤
**å¯¾ç­–**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®šã€ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½

ã“ã®è¨ˆç”»ã«åŸºã¥ãã€æ®µéšçš„ã«UCRçµ±åˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€æœã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°åˆ¤æ–­ã‚’ã‚ˆã‚ŠåŠ¹ç‡çš„ã§å®¢è¦³çš„ãªã‚‚ã®ã«ã—ã¦ã„ãã¾ã™ã€‚